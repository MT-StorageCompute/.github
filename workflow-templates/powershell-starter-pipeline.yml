name: powershell-starter-workflow

env: 
  working_dir: "subdirectory-here"
# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ dev ]
    paths:
      - working_dir/*

jobs:
  Run Tests:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    steps:
      - name: Sparse Checkout
        uses: gogaille/sparse-checkout@v0.1
        with:
          patterns: working_dir/*
    
      - name: Run Pester Tests
        shell: pwsh
        run: |
          $Results = Invoke-Pester working_dir/tests/ -PassThru